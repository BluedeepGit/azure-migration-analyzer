[
  {
    "id": "TENANT-RBAC-001",
    "resourceType": "*",
    "scenario": "cross-tenant",
    "severity": "Info",
    "message": "Role Assignments (RBAC)",
    "impact": "Le assegnazioni di ruolo (IAM) vengono eliminate permanentemente perché gli utenti/gruppi del vecchio tenant non esistono nel nuovo.",
    "workaround": "PRE-MOVE: Esportare le assegnazioni attuali. POST-MOVE: Ricreare le assegnazioni mappando i vecchi utenti ai nuovi utenti/gruppi.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/role-based-access-control/transfer-subscription#save-role-assignments"
  },
  {
    "id": "TENANT-RBAC-002",
    "resourceType": "microsoft.authorization/roledefinitions",
    "scenario": "cross-tenant",
    "severity": "Warning",
    "message": "Custom Roles",
    "impact": "I ruoli personalizzati definiti a livello di sottoscrizione vengono persi/eliminati.",
    "workaround": "PRE-MOVE: Esportare le definizioni JSON dei Custom Roles. POST-MOVE: Ricrearli nel nuovo tenant.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/role-based-access-control/transfer-subscription#re-create-custom-roles"
  },
  {
    "id": "TENANT-ID-001",
    "resourceType": "*",
    "scenario": "cross-tenant",
    "condition": { "field": "identity.type", "operator": "contains", "value": "SystemAssigned" },
    "severity": "Critical",
    "message": "System-assigned Managed Identities",
    "impact": "L'identità viene disabilitata. Qualsiasi servizio che usa MSI per accedere a KeyVault, SQL o Storage smetterà di funzionare.",
    "workaround": "POST-MOVE: Riabilitare l'identità. Riassegnare i permessi RBAC sulle risorse target.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/role-based-access-control/transfer-subscription#update-managed-identities"
  },
  {
    "id": "TENANT-ID-002",
    "resourceType": "*",
    "scenario": "cross-tenant",
    "condition": { "field": "identity.type", "operator": "contains", "value": "UserAssigned" },
    "severity": "Warning",
    "message": "User-assigned Managed Identities",
    "impact": "La risorsa Identity viene spostata, ma le assegnazioni di ruolo (RBAC) associate nel vecchio tenant vengono perse.",
    "workaround": "POST-MOVE: Ricreare le assegnazioni di ruolo nel nuovo tenant.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/role-based-access-control/transfer-subscription#update-managed-identities"
  },
  {
    "id": "TENANT-KV-001",
    "resourceType": "microsoft.keyvault/vaults",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Azure Key Vault",
    "impact": "Il Key Vault rimane legato al vecchio Tenant ID e diventa inaccessibile. Tutte le operazioni falliscono.",
    "workaround": "POST-MOVE: Eseguire 'Update-AzKeyVault -VaultName X -TenantId Y -RemoveParent'. Ricreare Access Policies.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/key-vault/general/move-subscription"
  },
  {
    "id": "TENANT-SQL-001",
    "resourceType": "microsoft.sql/servers",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Azure SQL Database (Entra Auth)",
    "impact": "Se l'autenticazione Entra ID è attiva, l'Admin viene rimosso e gli utenti DB non possono loggarsi.",
    "workaround": "POST-MOVE: Reimpostare Admin Entra ID. Eseguire ALTER USER per mappare gli utenti.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/azure-sql/database/authentication-aad-configure"
  },
  {
    "id": "TENANT-MYSQL-001",
    "resourceType": "microsoft.dbformysql/flexibleservers",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Azure MySQL Flexible (Entra Auth)",
    "impact": "L'autenticazione Entra ID non è supportata durante il trasferimento.",
    "workaround": "PRE-MOVE: Disabilitare Entra Auth. POST-MOVE: Riabilitarlo e riconfigurare gli utenti.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/mysql/flexible-server/how-to-azure-ad"
  },
  {
    "id": "TENANT-PSQL-001",
    "resourceType": "microsoft.dbforpostgresql/flexibleservers",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Azure PostgreSQL Flexible (Auth & CMK)",
    "impact": "Entra Auth si rompe. Se si usa Customer Managed Key (CMK) con System Managed Identity, il database potrebbe diventare inaccessibile.",
    "workaround": "PRE-MOVE: Se CMK è attivo, passare a User Assigned Identity. Disabilitare Entra Auth.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/how-to-manage-azure-ad-users"
  },
  {
    "id": "TENANT-STG-001",
    "resourceType": "microsoft.storage/storageaccounts",
    "scenario": "cross-tenant",
    "severity": "Info",
    "message": "Azure Storage & ADLS Gen2",
    "impact": "Le ACL RBAC (es. Blob Data Reader) vengono perse. Le chiavi di accesso (Shared Key) continuano a funzionare.",
    "workaround": "POST-MOVE: Riassegnare i ruoli RBAC agli utenti nel nuovo tenant.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/storage/common/storage-auth-aad"
  },
  {
    "id": "TENANT-FILES-001",
    "resourceType": "microsoft.storage/storageaccounts/fileservices",
    "scenario": "cross-tenant",
    "severity": "Warning",
    "message": "Azure Files Identity Integration",
    "impact": "Se integrato con AD DS o Entra Domain Services, l'integrazione potrebbe rompersi se il dominio non è visibile o se le ACL sono basate su SID del vecchio tenant.",
    "workaround": "Verificare connettività AD. Potrebbe essere necessario riconfigurare l'integrazione Directory.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/storage/files/storage-files-identity-auth-active-directory-enable"
  },
  {
    "id": "TENANT-AFS-001",
    "resourceType": "microsoft.storagesync/storagesyncservices",
    "scenario": "cross-tenant",
    "severity": "Blocker",
    "message": "Azure File Sync",
    "impact": "Il servizio Storage Sync non supporta il cambio tenant automatico dei server registrati.",
    "workaround": "PRE-MOVE: Eliminare Server Endpoints e deregistrare i server. POST-MOVE: Ricreare Sync Groups e registrare nuovamente i server.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/storage/files/storage-files-faq#azure-file-sync"
  },
  {
    "id": "TENANT-DISK-001",
    "resourceType": "microsoft.compute/diskencryptionsets",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Managed Disks (Customer Managed Keys)",
    "impact": "I Disk Encryption Sets sono legati a Key Vaults. Se il KV si sposta e cambia Tenant ID, i dischi non possono decriptarsi.",
    "workaround": "PRE-MOVE: Assicurarsi che la Identity del DiskEncryptionSet sia User-Assigned (raccomandato) o prepararsi a fixare il KV immediatamente.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/virtual-machines/disk-encryption"
  },
  {
    "id": "TENANT-AKS-001",
    "resourceType": "microsoft.containerservice/managedclusters",
    "scenario": "cross-tenant",
    "severity": "Blocker",
    "message": "Azure Kubernetes Service (AKS)",
    "impact": "Il cluster perde le identità (SPN/MSI). Microsoft dichiara 'not supported' per il mantenimento operativo.",
    "workaround": "BEST PRACTICE: Creare nuovo cluster nel nuovo tenant e redeployare i workload. Non migrare la risorsa.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/aks/faq#can-i-move-my-cluster-between-tenants"
  },
  {
    "id": "TENANT-POL-001",
    "resourceType": "microsoft.authorization/policyassignments",
    "scenario": "cross-tenant",
    "severity": "Warning",
    "message": "Azure Policy Assignments",
    "impact": "Le assegnazioni di Policy vengono eliminate durante il trasferimento.",
    "workaround": "Esportare le definizioni di Policy. Riapplicare le assegnazioni nella nuova sottoscrizione/tenant.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/governance/policy/how-to/export-resources"
  },
  {
    "id": "TENANT-ADDS-001",
    "resourceType": "microsoft.aad/domainservices",
    "scenario": "cross-tenant",
    "severity": "Blocker",
    "message": "Microsoft Entra Domain Services",
    "impact": "Questa risorsa NON può essere spostata tra tenant. È legata indissolubilmente alla directory sorgente.",
    "workaround": "Eliminare la risorsa Managed Domain. Ricrearla nel nuovo tenant (perdita dati profili utente/GPO non backuppati).",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/entra/identity/domain-services/faqs"
  },
  {
    "id": "TENANT-WEB-001",
    "resourceType": "microsoft.web/sites",
    "scenario": "cross-tenant",
    "condition": { "field": "properties.siteAuthEnabled", "operator": "eq", "value": true },
    "severity": "Critical",
    "message": "Web App - App Registrations (Auth)",
    "impact": "L'autenticazione EasyAuth si rompe perché l'App Registration rimane nel vecchio tenant.",
    "workaround": "PRE-MOVE: Disabilitare Auth. POST-MOVE: Creare nuova App Registration e riconfigurare.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/app-service/manage-move-across-regions"
  },
  {
    "id": "TENANT-DEV-001",
    "resourceType": "microsoft.devcenter/projects",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Dev Box & Deployment Environments",
    "impact": "Le identità utente assegnate ai progetti non sono valide nel nuovo tenant.",
    "workaround": "Riassegnare i ruoli agli sviluppatori nel nuovo tenant.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/role-based-access-control/transfer-subscription"
  },
  {
    "id": "TENANT-SF-001",
    "resourceType": "microsoft.servicefabric/clusters",
    "scenario": "cross-tenant",
    "severity": "Warning",
    "message": "Azure Service Fabric",
    "impact": "Il cluster si sposta, ma i certificati cluster e client (spesso in KV) o le app AAD devono essere aggiornati.",
    "workaround": "Aggiornare Key Vault e App Registration. Ridistribuire configurazione cluster se necessario.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/service-fabric/"
  },
  {
    "id": "TENANT-SB-001",
    "resourceType": "microsoft.servicebus/namespaces",
    "scenario": "cross-tenant",
    "severity": "Info",
    "message": "Azure Service Bus",
    "impact": "Le regole RBAC per l'accesso alle code/topic vengono perse. Le Shared Access Policies (SAS) rimangono valide.",
    "workaround": "Riassegnare i ruoli RBAC (Data Owner/Sender) nel nuovo tenant.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/service-bus-messaging/"
  },
  {
    "id": "TENANT-SYN-001",
    "resourceType": "microsoft.synapse/workspaces",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Azure Synapse Analytics",
    "impact": "La System Managed Identity del workspace viene ricreata. Pipeline e Linked Services che usano MSI falliranno.",
    "workaround": "POST-MOVE: Aggiornare le ACL su Data Lake Gen2 con la nuova identità. Fixare i permessi SQL Admin.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/synapse-analytics/security/how-to-grant-workspace-managed-identity-permissions"
  },
  {
    "id": "TENANT-DBX-001",
    "resourceType": "microsoft.databricks/workspaces",
    "scenario": "cross-tenant",
    "severity": "Critical",
    "message": "Azure Databricks",
    "impact": "Gli utenti non possono loggarsi (SSO rotto). Le Managed Identity usate per il mount storage si rompono.",
    "workaround": "Riconfigurare l'autenticazione Entra ID e i mount point dello storage.",
    "downtimeRisk": true,
    "refLink": "https://learn.microsoft.com/en-us/azure/databricks/admin/account-settings/#move-workspace-between-tenants-unsupported"
  },
  {
    "id": "TENANT-GAL-001",
    "resourceType": "microsoft.compute/galleries",
    "scenario": "cross-tenant",
    "severity": "Info",
    "message": "Azure Compute Gallery",
    "impact": "Controllo accessi RBAC perso. Le immagini rimangono disponibili.",
    "workaround": "Riassegnare i ruoli per permettere ai team di vedere/usare le immagini.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/virtual-machines/azure-compute-gallery"
  },
  {
    "id": "TENANT-LOCK-001",
    "resourceType": "microsoft.authorization/locks",
    "scenario": "cross-tenant",
    "severity": "Blocker",
    "message": "Azure Resource Locks",
    "impact": "Se sono presenti Lock (CanNotDelete/ReadOnly), il trasferimento della sottoscrizione potrebbe fallire o bloccare la pulizia.",
    "workaround": "PRE-MOVE: Rimuovere tutti i Resource Locks dalla sottoscrizione e dai Resource Group.",
    "downtimeRisk": false,
    "refLink": "https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/lock-resources"
  }
]